{
  "hash": "494a878833a82746d94e6d6b42a9f00a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session 13 Code\"\nauthor: \"Carolyn Koehn\"\nformat: html\n---\n\n\n\n\n\n## Code from slides\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(terra)\n\nsrtm = rast(system.file(\"raster/srtm.tif\", package = \"spDataLarge\"))\n\nsrtm3  <-  focal(x = srtm, w = 3)\nsrtm9  <-  focal(x = srtm, w = 9)\nsrtm21  <-  focal(x = srtm, w = 21)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsrtmsum  <-  focal(x = srtm, w = 3, fun=\"sum\")\nsrtmmax  <-  focal(x = srtm, w = 9, fun=\"mean\")\nsrtmmin  <-  focal(x = srtm, w = 21, fun=\"min\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsrtm.lowelev <- srtm\nsrtm.lowelev[srtm.lowelev > 2500] <- 1\nplot(srtm.lowelev)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsrtm.na <- srtm\nsrtm.na[200:300, 200:300] <- NA\nsrtm.na[is.na(srtm.na)] <- 8000\nplot(srtm.na)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmintemp <- rast(\"ftp://ftp.hafro.is/pub/data/rasters/Iceland_minbtemp.tif\")\ncm <- matrix(c(\n  -2, 2, 0,\n  2, 4, 1,\n  4, 10, 2), ncol = 3, byrow = TRUE)\n\n# Create a raster with integers\ntemp_reclass <- classify(mintemp, cm)\ntempcats <- c(\"cold\", \"mild\", \"warm\")\nlevels(temp_reclass) <- tempcats\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: [set.cats] setting categories like this is deprecated; use a\ntwo-column data.frame instead\n```\n\n\n:::\n:::\n\n\nReassigning the levels like this shows a warning that this method is deprecated. This is the two column data.frame method it prefers:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempcats2 <- data.frame(value = c(0, 1, 2),\n                        category = c(\"cold\", \"mild\", \"warm\"))\n\nlevels(temp_reclass) <- tempcats2\n```\n:::\n\n\n## Hillshade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsrtm.slope <- terrain(srtm, \"slope\", unit=\"radians\")\nsrtm.aspect <- terrain(srtm, \"aspect\", unit=\"radians\")\n\nsrtm.shade <- shade(srtm.slope, srtm.aspect)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(srtm.shade, col=grey(0:100/100), legend=FALSE)\nplot(srtm, col=rainbow(25, alpha=0.35), add=TRUE)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Practice:\n\n### Load wildfire risk data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwildfire.risk <- rast(\"/opt/data/data/rasterexample/Copy of CRPS_ID.tif\")\n\nplot(wildfire.risk)\n```\n:::\n\n\n\n\n### Get boundary for county\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\n\nid_counties <- tigris::counties(\"ID\", progress_bar = FALSE)\n\nada.cty <- filter(id_counties, NAME == \"Ada\")\n\nplot(st_geometry(ada.cty))\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Reclassify wildfire data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Method 1\nrcl <- data.frame(from = c(0,10,30,50,80),\n                  to = c(10,30,50,80,100),\n                  becomes = c(0:4))\n\n# Method 2\nrcl.m <- matrix(c(\n  0, 10, 0,\n  10, 30, 1,\n  30, 50, 2,\n  50, 80, 3,\n  80, 100, 4\n), ncol=3, byrow=TRUE)\n\n# Both methods work for the second argument\nwr_reclass <- classify(wildfire.risk, rcl.m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n\n\n:::\n\n```{.r .cell-code}\n# Add names\nwr_cats <- data.frame(value = 0:4,\n                      category = c(\"No worries\", \n                                   \"A little bit risky\",\n                                   \"Moderate risk\",\n                                   \"Very risky\",\n                                   \"Don't move here\"))\nlevels(wr_reclass) <- wr_cats\n\nplot(wr_reclass)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### Smooth categorical raster\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwr_sm <- focal(wr_reclass, w=7, fun=\"modal\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n\n\n:::\n\n```{.r .cell-code}\nplot(wr_sm)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n### Make county-level map\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# match CRS\nada_proj <- st_transform(ada.cty, crs(wr_sm))\n\nwr_sm_ada <- crop(wr_sm, ada_proj, mask=TRUE)\n\nplot(wr_sm_ada)\n```\n\n::: {.cell-output-display}\n![](session-13-example_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "session-13-example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}