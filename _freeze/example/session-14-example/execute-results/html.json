{
  "hash": "2ebd9e53a3b1928ae98e1a2d408d242b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session 14 code\"\nauthor: \"Carolyn Koehn\"\nformat: html\n---\n\n\n\n\nLibraries for today:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse, quietly = TRUE)\nlibrary(spData)\nlibrary(sf)\n```\n:::\n\n\n\n\n## Subsetting Data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(world)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"iso_a2\"    \"name_long\" \"continent\" \"region_un\" \"subregion\" \"type\"     \n [7] \"area_km2\"  \"pop\"       \"lifeExp\"   \"gdpPercap\" \"geom\"     \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(world)[,1:3] %>% \n  st_drop_geometry()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  iso_a2 name_long      continent    \n* <chr>  <chr>          <chr>        \n1 FJ     Fiji           Oceania      \n2 TZ     Tanzania       Africa       \n3 EH     Western Sahara Africa       \n4 CA     Canada         North America\n5 US     United States  North America\n6 KZ     Kazakhstan     Asia         \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld %>%\n  dplyr::select(name_long, continent) %>%\n  st_drop_geometry() %>% \n  head(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  name_long      continent    \n  <chr>          <chr>        \n1 Fiji           Oceania      \n2 Tanzania       Africa       \n3 Western Sahara Africa       \n4 Canada         North America\n5 United States  North America\n6 Kazakhstan     Asia         \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(world)[1:3, 1:3] %>% \n  st_drop_geometry()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  iso_a2 name_long      continent\n* <chr>  <chr>          <chr>    \n1 FJ     Fiji           Oceania  \n2 TZ     Tanzania       Africa   \n3 EH     Western Sahara Africa   \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld %>%\n  filter(continent == \"Asia\") %>% \n  select(name_long, continent) %>%\n  st_drop_geometry() %>% \n  head(.)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  name_long   continent\n  <chr>       <chr>    \n1 Kazakhstan  Asia     \n2 Uzbekistan  Asia     \n3 Indonesia   Asia     \n4 Timor-Leste Asia     \n5 Israel      Asia     \n6 Lebanon     Asia     \n```\n\n\n:::\n:::\n\n\n\n\n## Create new columns\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_dens <- world %>%\n  filter(continent == \"Asia\") %>% \n  select(name_long, continent, pop, gdpPercap ,area_km2) %>%\n  mutate(., dens = pop/area_km2,\n         totGDP = gdpPercap * pop) %>%\n  st_drop_geometry() %>% \n  head(.)\n```\n:::\n\n\n\n\n## Aggregate / Summarise\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld %>%\n  st_drop_geometry(.) %>% \n  group_by(continent) %>%\n  summarize(pop = sum(pop, na.rm = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 2\n  continent                      pop\n  <chr>                        <dbl>\n1 Africa                  1154946633\n2 Antarctica                       0\n3 Asia                    4311408059\n4 Europe                   669036256\n5 North America            565028684\n6 Oceania                   37757833\n7 Seven seas (open ocean)          0\n8 South America            412060811\n```\n\n\n:::\n:::\n\n\n\n\n## Joins\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(coffee_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  name_long                coffee_production_2016 coffee_production_2017\n  <chr>                                     <int>                  <int>\n1 Angola                                       NA                     NA\n2 Bolivia                                       3                      4\n3 Brazil                                     3277                   2786\n4 Burundi                                      37                     38\n5 Cameroon                                      8                      6\n6 Central African Republic                     NA                     NA\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_coffee = left_join(world, coffee_data)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(name_long)`\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(world_coffee)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 177\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(world_coffee[\"coffee_production_2016\"])\n```\n\n::: {.cell-output-display}\n![](session-14-example_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_coffee_inner = inner_join(world, coffee_data)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(name_long)`\n```\n\n\n:::\n\n```{.r .cell-code}\nnrow(world_coffee_inner)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 45\n```\n\n\n:::\n:::\n\n\n\n\n## Practice:\n\nWhat is the population density for the tracts in the cejst data? Our data sources are:\n\n- Total population in each tract (`cejst$TPF`)\n- Area in $m^2$ of each tract (`tigris::tracts()`, column `ALAND`)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncejst <- st_read(\"/opt/data/data/assignment06/cejst_pnw.shp\")\n\nid_tracts <- tigris::tracts(state = \"ID\", year = 2015)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncejst_id <- cejst %>%\n  filter(SF == \"Idaho\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nid_tracts <- id_tracts %>%\n  mutate(ALAND_sqmi = ALAND/2589988.11)\nhead(id_tracts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 13 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -117.0628 ymin: 41.99601 xmax: -111.5077 ymax: 46.39597\nGeodetic CRS:  NAD83\n  STATEFP COUNTYFP TRACTCE       GEOID    NAME             NAMELSAD MTFCC\n1      16      041  970200 16041970200    9702    Census Tract 9702 G5020\n2      16      041  970100 16041970100    9701    Census Tract 9701 G5020\n3      16      073  950200 16073950200    9502    Census Tract 9502 G5020\n4      16      073  950101 16073950101 9501.01 Census Tract 9501.01 G5020\n5      16      073  950102 16073950102 9501.02 Census Tract 9501.02 G5020\n6      16      069  960700 16069960700    9607    Census Tract 9607 G5020\n  FUNCSTAT       ALAND   AWATER    INTPTLAT     INTPTLON\n1        S   455342589  2412885 +42.0609834 -111.7147361\n2        S  1263363258  9752226 +42.2231666 -111.8485407\n3        S 19603341439 77025612 +42.5728508 -116.1896903\n4        S   117363851  1585581 +43.5924261 -116.9602208\n5        S   132949223  2844915 +43.5247849 -116.8481343\n6        S   770216313  9225885 +46.0956517 -116.8989005\n                        geometry ALAND_sqmi\n1 POLYGON ((-111.935 42.00164...  175.80876\n2 POLYGON ((-112.1263 42.2853...  487.78728\n3 POLYGON ((-117.027 43.54418... 7568.89245\n4 POLYGON ((-117.0268 43.6465...   45.31444\n5 POLYGON ((-116.9284 43.5437...   51.33198\n6 POLYGON ((-117.0628 46.3652...  297.38218\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nid_tracts <- st_drop_geometry(id_tracts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncejst_id_join <- inner_join(cejst_id, id_tracts,\n                            by = c(\"GEOID10\" = \"GEOID\")) %>%\n  mutate(pop_dens = TPF/ALAND_sqmi)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(cejst_id_join[\"pop_dens\"])\n```\n\n::: {.cell-output-display}\n![](session-14-example_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\nlibrary(tmap)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nBreaking News: tmap 3.x is retiring. Please test v4, e.g. with\nremotes::install_github('r-tmap/tmap')\n```\n\n\n:::\n\n```{.r .cell-code}\ntm_shape(cejst_id_join) +\n  tm_polygons(col = \"pop_dens\")\n```\n\n::: {.cell-output-display}\n![](session-14-example_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(cejst_id_join, aes(x=pop_dens, y=IS_PFS)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](session-14-example_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::",
    "supporting": [
      "session-14-example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}