{
  "hash": "cc4ab17c1d2ad00562df22efa8819b69",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session 21 code\"\nauthor: \"Carolyn Koehn\"\nformat: html\n---\n\n\n\n\nLoad libraries:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(spDataLarge)\nlibrary(sf)\n```\n:::\n\n\n\n\n## Overlays\n\nGet land cover data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnlcd <-  rast(system.file(\"raster/nlcd.tif\", package = \"spDataLarge\"))\nplot(nlcd)\n```\n\n::: {.cell-output-display}\n![](session-21-example_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\nSeparate categorical raster into Boolean layers:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnlcd.segments <- segregate(nlcd)\n# rename layers of raster stack\nnames(nlcd.segments) <- levels(nlcd)[[1]][-1,2]\nplot(nlcd.segments)\n```\n\n::: {.cell-output-display}\n![](session-21-example_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\nGet slope data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# elevation data\nsrtm <- rast(system.file(\"raster/srtm.tif\", package = \"spDataLarge\"))\n# get slope\nslope <- terrain(srtm, v = \"slope\")\n```\n:::\n\n\n\n\nPrepare overlay layers:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# only slopes less than 10 are suitable\nsuit.slope <- slope < 10\n# only shrubland is suitable\nsuit.landcov <- nlcd.segments[\"Shrubland\"]\n# make sure raster layers align\nsuit.slope.match <- project(suit.slope, suit.landcov)\n```\n:::\n\n\n\n\nRun overlay analysis:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuit <- suit.slope.match + suit.landcov\n\nplot(suit)\n```\n\n::: {.cell-output-display}\n![](session-21-example_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Logistic regression\n\nGet data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get presence-absence simulated data\npresabs <- st_read(\"/opt/data/data/presabsexample/presenceabsence.shp\", quiet = TRUE)\n\n# get predictor data file paths\npreds.list <- list.files(\"/opt/data/data/presabsexample\", \"grd$\", full.names = TRUE)\n# get predictors as raster stack\npred.stack <- rast(preds.list)\n# rename layers of raster stack\nnames(pred.stack) <- c(\"MeanAnnTemp\", \"TotalPrecip\", \"PrecipWetQuarter\", \"PrecipDryQuarter\", \"MinTempCold\", \"TempRange\")\n```\n:::\n\n\n\n\n\n\nExtract predictor data at each point and add presence/absence column called `y`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npts.df <- terra::extract(pred.stack, presabs)\npts.df[,2:7] <- scale(pts.df[,2:7])\n\npts.df$y <- presabs$y\n```\n:::\n\n\n\n\nFit logistic regression model:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogistic.carolyn <- glm(y ~ TempRange + PrecipDryQuarter, \n                        family = binomial(link = \"logit\"),\n                        data = pts.df)\n\nsummary(logistic.carolyn)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = y ~ TempRange + PrecipDryQuarter, family = binomial(link = \"logit\"), \n    data = pts.df)\n\nCoefficients:\n                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)       -1.2820     0.3789  -3.384 0.000715 ***\nTempRange         -3.5156     0.7984  -4.403 1.07e-05 ***\nPrecipDryQuarter   0.4157     0.5938   0.700 0.483969    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 125.37  on 99  degrees of freedom\nResidual deviance:  59.18  on 97  degrees of freedom\nAIC: 65.18\n\nNumber of Fisher Scoring iterations: 6\n```\n\n\n:::\n:::\n\n\n\n\nPredict model results across entire study area:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewpreds <- predict(pred.stack, logistic.carolyn, type = \"response\")\nplot(newpreds)\n```\n\n::: {.cell-output-display}\n![](session-21-example_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "session-21-example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}