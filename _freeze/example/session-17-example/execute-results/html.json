{
  "hash": "f91cd85c11b6ebe0d20117d3aa3ceda1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session 17 code\"\nauthor: \"Carolyn Koehn\"\nformat: html\n---\n\n\n\nLoad libraries:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rgbif)\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(spatstat)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.data\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.univar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.univar 3.0-0\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.geom\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.geom 3.3-2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.random\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.random 3.3-1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.explore\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: nlme\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.explore 3.3-1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.model\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: rpart\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.model 3.3-1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: spatstat.linnet\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nspatstat.linnet 3.2-1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nspatstat 3.1-1 \nFor an introduction to spatstat, type 'beginner' \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::collapse() masks nlme::collapse()\n✖ dplyr::filter()   masks stats::filter()\n✖ dplyr::lag()      masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n\nGet data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nid <- tigris::states() %>%\n  filter(NAME == \"Idaho\") %>%\n  st_transform(crs=4326)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRetrieving data for the year 2021\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=====                                                                 |   6%\n  |                                                                            \n  |=====                                                                 |   7%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |======                                                                |   8%\n  |                                                                            \n  |======                                                                |   9%\n  |                                                                            \n  |=======                                                               |   9%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |=======                                                               |  11%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |=========                                                             |  13%\n  |                                                                            \n  |=========                                                             |  14%\n  |                                                                            \n  |==========                                                            |  14%\n  |                                                                            \n  |==========                                                            |  15%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |==============                                                        |  21%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |================                                                      |  22%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |=================                                                     |  24%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |=====================                                                 |  30%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |=============================                                         |  42%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===================================                                   |  51%\n  |                                                                            \n  |=====================================                                 |  52%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=================================================                     |  69%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngold_eag <- occ_search(scientificName = \"Aquila chrysaetos\",\n                       country = \"US\",\n                       hasCoordinate = TRUE,\n                       limit = 1000)\n```\n:::\n\n\n\nPrepare data for analysis:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngold_eag_dat <- gold_eag$data\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert to spatial data\ngold_eag_sf <- gold_eag_dat %>%\n  filter(!is.na(decimalLatitude) & !is.na(decimalLongitude)) %>%\n  st_as_sf(., coords = c(\"decimalLongitude\", \"decimalLatitude\"), crs=4326)\n\nplot(st_geometry(gold_eag_sf))\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# subset to study area\ngold_eag_id <- gold_eag_sf[id, ]\n\nplot(st_geometry(id))\nplot(st_geometry(gold_eag_id), add=TRUE)\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Kernel Density Estimates\n\n### Prepare data for spatstat\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# must be mapped on a plane - projected CRS\ngold_eag_id_proj <- st_transform(gold_eag_id, crs = 5070)\nid_proj <- st_transform(id, crs = 5070)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert to ppp object\ngold_eag.ppp <- gold_eag_id_proj %>%\n  as.ppp()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in as.ppp.sf(.): only first attribute column is used for marks\n```\n\n\n:::\n\n```{.r .cell-code}\n# remove marks from points\nmarks(gold_eag.ppp) <- NULL\n# set study area to Idaho\nWindow(gold_eag.ppp) <- as.owin(id_proj)\n```\n:::\n\n\n\n### Kernel Density Estimates with different bandwidths\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkde0 <- density(gold_eag.ppp)\nplot(kde0, main=\"Default KDE for ID golden eagles\")\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nkde1 <- density(gold_eag.ppp, adjust = 0.75)\nplot(kde1, main=\"Bandwidth reduced by 0.75\")\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n\n## Ripley's K\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nk0 <- Kest(gold_eag.ppp)\nplot(k0)\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\nThe x axis shows the increasing radius of the circle tested and the y axis shows the $K$ at any given radius.\n\nDifferent color lines show difference edge corrections. In the next step, we used `border` because it is the fastest. More information on edge correction can be found in the details section of the `Kest` help file (`?Kest`).\n\nTo test whether our points are clustered, we generate a $K$ for completely spatially random points (red line below).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nk.env <- envelope(gold_eag.ppp, correction=\"border\", envelope = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGenerating 99 simulations of CSR  ...\n1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,\n21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,\n41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,\n61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,\n81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, \n99.\n\nDone.\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(k.env)\n```\n\n::: {.cell-output-display}\n![](session-17-example_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\nThe error is generated by the 99 simulations of CSR printed as output. Here, we see our data are clustered (spatially autocorrelated) from the very smallest scale (r = 1) to a radius of about 90,000 meters.",
    "supporting": [
      "session-17-example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}